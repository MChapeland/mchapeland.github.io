<!DOCTYPE html>
<html>

<head>

	<!-- Title of the page -->
	<title>Project World Map</title>

	<!-- Page Setup -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=2.0" />
	<meta http-equiv="X-UA-Compatible" content="ie-edge" />

	<link rel="stylesheet" href="index.css" />
	<link rel="stylesheet" href="src/sidebar.css" />
	<script src="src/sidebar.js" defer></script>
	<link rel="stylesheet" href="src/layers.css" />
	<script src="src/layers.js" defer></script>
	<link rel="stylesheet" href="src/search.css" />
	<script src="src/search.js" defer></script>

	<!-- Leaflet Scripts -->
	<link rel="stylesheet" href="src/leaflet.css" />
	<script src="src/leaflet.js"></script>

</head>


<body>

	<!-- Map -->
	<div id="map"></div>

	<!-- Sidebar -->
	<div class="sidebar" id="Main">

		<div class="sidebar-grid">
		
			<img src="src/images/logo.svg" />

			<div style="flex: 1;"></div>

			<button class="sidebar-button" id="SearchButton" onclick="toggleDrop(event, 'Search')">
				<img src="src/images/icons/search.svg" style="max-height: 20px;"/>
			</button>

			<button class="sidebar-button" id="LayersButton" onclick="toggleDrop(event, 'Layers')">
				<img src="src/images/icons/markers.svg" style="max-height: 20px;" />
			</button>

			<button class="sidebar-button" id="AreasButton" onclick="toggleDrop(event, 'Areas')">
				<img src="src/images/icons/layers.svg" style="max-height: 20px;"/>
			</button>

			<button class="sidebar-button" id="OptionsButton" onclick="toggleDrop(event, 'Options')">
				<img src="src/images/icons/options.svg" style="max-height: 20px;"/>
			</button>

		</div>

	</div>

	<!-- SIDEBAR DROPS -->
	<!-- Search -->
	<div class="tabs" id="Search">

		<div class="search-box">

			<input class="searchInput" type="text" placeholder="Search Markers..." />

			<button class="search-button" href="#">
				<img src="src/images/icons/search.svg" />
            </button>

		</div>

		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>John</label>
			<p>Lore, lamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>Quis nostrud exercitation ullamco laboris nisi ut aliqu</label>
			<p>Loralp ex ea commodo consequat. </p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>Path</label>
			<p>Lorqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>Ring</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>Warzone</label>
			<p>Lorem.</p>
		</div>

		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>City</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>Defense</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>Archery</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, consna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>

		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, coniam, quis nosmco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, consectetim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>John</label>
			<p>Lorem ipsummmodo consequat.</p>
		</div>

		<div class="search-result">
			<img src="src/images/markers/white/target.svg"/>
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>

	</div>

	<!-- Layers -->
	<div class="tabs" id="Layers">

		<div class="visibility-header">
			<div class="visibility-button">
				<label>View</label>
				<input type="checkbox" onchange="toggleViewLayers(event)" checked id="viewLayersCheckbox">
			</div>
			<div class="visibility-button">
				<label>List</label>
				<input type="checkbox" onchange="toggleListLayers(event)" checked id="listLayersCheckbox">
			</div>
		</div>


		<!--
		<div class="custom-layer-group" id="groupCheckboxParent">

			<div class="group-container">

				<div class="arrow-container">
					<div class="arrow"></div>
					<input type="checkbox" onchange="toggleArrowLayers(event)">
				</div>

				<div class="visibility-box">
					<label>NPCs</label>
					<input type="checkbox" onchange="layerGroupVisibility(event, 'groupCheckbox')" checked id="groupCheckbox">
				</div>

            </div>

			<div class="layer-grid">

				<div class="layer-container" id="myLayer">
					<img src="src/images/markers/white/target.svg" />
					<label>NPCs</label>
					<input type="number" value="1" readonly>
					<div class="checkbox-container">
						<input type="checkbox" onchange="markerGroupVisibility(event, 'groupCheckbox', myLayer)" id="L_myLayer-groupCheckbox"  checked>
					</div>

				</div>

			</div>
			
			
		</div>
		-->
		

	</div>

	
	<!-- Areas -->
	<div class="tabs" id="Areas">

		<div class="visibility-header">
			<div class="visibility-button">
				<label>View</label>
				<input type="checkbox" onchange="toggleViewAreas(event)" checked id="viewAreasCheckbox">
			</div>
			<div class="visibility-button">
				<label>List</label>
				<input type="checkbox" onchange="toggleListAreas(event)" checked id="listAreasCheckbox">
			</div>
		</div>

	</div>

	<!-- Options -->
	<div class="tabs" id="Options">

	</div>







	<script>

		//Map Setup
		var map = L.map('map', { 'attributionControl': false, zoomControl: false }).setView([-15, 15], 2);
		
		/*
		map.on('zoomend', function zoomendEvent(ev) {
			var currentZoomLevel = ev.target.getZoom(),
			mapDiv = map.getContainer(),
			minZoomToShowPtLayer = 6; // or whatever
			console.log(currentZoomLevel);

			if (currentZoomLevel >= minZoomToShowPtLayer) {
				mapDiv.classList.add('hide-point-layer');
			} else {
				mapDiv.classList.remove('hide-point-layer');
			}
		});
		*/

		var tiles = L.tileLayer('map/{z}/{x}/{y}.png', {
			continuousWorld: false,
			noWrap: true,
			minZoom: 2,
			maxZoom: 6
		}).addTo(map);

		var BaseIcon = L.Icon.extend({
			options: {
				iconSize: [25, 25],
				iconAnchor: [12.5, 12.5],
				popupAnchor: [-0.5, -42],
				tooltipAnchor: [19.5, -25]
			}
		});

		/*
		var myLayer = L.layerGroup().addTo(map);


		var myMarker = L
			.marker([0, 0], {	icon: new BaseIcon({ iconUrl: `src/images/markers/white/target.svg`}) })
			.addTo(myLayer)
			.bindPopup(`<label><b>Name</b></label>`, {closeButton: false})
			.bindTooltip("Name")
		;
		*/





        // Data fetched from Google Sheets
        const sheetName = 'data';
        const query = encodeURIComponent('Select *');
        const url = `https://docs.google.com/spreadsheets/d/1lB1RY3fwmw9k0t_M4vQt6z__ieHWX7frPUhjbey-9S0/gviz/tq?&sheet=${sheetName}&tq=${query}`;

		var sheetData = [];
        document.addEventListener('DOMContentLoaded', sheetExtract);

        function sheetExtract() {
            fetch(url)
			.then(res => res.text())
			.then(rep => {

				const refinedData = JSON.parse(rep.substr(47).slice(0, -2));

				refinedData.table.rows.forEach((main) => {
					
					var storedMarker = {};

					storedMarker.name = main.c[0].v;
					storedMarker.x = main.c[1].v;
					storedMarker.y = main.c[2].v;
					storedMarker.lod = main.c[3].v;
					storedMarker.group = main.c[4].v;
					storedMarker.layer = main.c[5].v;
					storedMarker.color = main.c[6].v;
					storedMarker.icon = main.c[7].v;
					storedMarker.description = main.c[8].v;
					storedMarker.id = main.c[9].v;
					storedMarker.sheet = sheetName;
						
					sheetData.push(storedMarker);
					console.log(sheetData);
				});
			});
        }


	</script>

</html>