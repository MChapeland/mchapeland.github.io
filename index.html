<!DOCTYPE html>
<html>
<head>

    <!-- Title of the page -->
    <title>Project World Map</title>

    <!-- Page Setup -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=2.0" />
    <meta http-equiv="X-UA-Compatible" content="ie-edge" />

    <!-- Index Scripts -->
    <link tag="indexCSS" rel="stylesheet" type="text/css" href="index.css" />

    <!-- Leaflet Scripts -->
    <link tag="leafletCSS" rel="stylesheet" href="scripts/leaflet.css" />
    <script tag="leafletJS" src="scripts/leaflet.js"></script>

</head>


<body>

    <div class="header">
        <label>PROJECT MAP</label>
    </div>

    <input type="checkbox" class="openSidebarMenu" id="openSidebarMenu">

    <label for="openSidebarMenu" class="sidebarIconToggle">
        <div class="spinner diagonal part-1"></div>
        <div class="spinner horizontal"></div>
        <div class="spinner diagonal part-2"></div>
    </label>

    <div id="sidebarMenu">
    </div>

    <div class="main">

        <div id="map"></div>
         


    </div>


    <script>

        // Map Setup
        var map = L.map('map').setView([-40, 0], 2);

        var tiles = L.tileLayer('map/{z}/{x}/{y}.png', {
            continuousWorld: false,
            noWrap: true,
            minZoom: 2,
            maxZoom: 4,
        }).addTo(map);

        var BaseIcon = L.Icon.extend({
            options: {
                shadowUrl: 'img/marker-shadow.png',
                iconSize: [30],
                shadowSize: [50, 64],
                iconAnchor: [3, 48],
                shadowAnchor: [3, 63],
                popupAnchor: [11, -50]
            }

        });


        // Marker Colors
        var red = new BaseIcon({ iconUrl: 'img/marker-icon-red.svg' });
        var orangeM = new BaseIcon({ iconUrl: 'img/marker-icon-orange.svg' });
        var yellowM = new BaseIcon({ iconUrl: 'img/marker-icon-yellow.svg' });
        var greenM = new BaseIcon({ iconUrl: 'img/marker-icon-green.svg' });
        var tealM = new BaseIcon({ iconUrl: 'img/marker-icon-teal.svg' });
        var cyanM = new BaseIcon({ iconUrl: 'img/marker-icon-cyan.svg' });
        var blueM = new BaseIcon({ iconUrl: 'img/marker-icon-blue.svg' });
        var purpleM = new BaseIcon({ iconUrl: 'img/marker-icon-purple.svg' });
        var pinkM = new BaseIcon({ iconUrl: 'img/marker-icon-pink.svg' });
        var whiteM = new BaseIcon({ iconUrl: 'img/marker-icon-white.svg' });
        var greyM = new BaseIcon({ iconUrl: 'img/marker-icon-grey.svg' });
        var blackM = new BaseIcon({ iconUrl: 'img/marker-icon-black.svg' });


        // Data fetched from Google Sheets
        const sheetID = '1lB1RY3fwmw9k0t_M4vQt6z__ieHWX7frPUhjbey-9S0';
        const base = 'https://docs.google.com/spreadsheets/d/1lB1RY3fwmw9k0t_M4vQt6z__ieHWX7frPUhjbey-9S0/gviz/tq?';

        const sheetName = 'users';

        const query = encodeURIComponent('Select *');

        const url = `${base}&sheet=${sheetName}&tq=${query}`;

        document.addEventListener('DOMContentLoaded', sheetExtract);

        function sheetExtract() {
            fetch(url)
                .then(res => res.text())
                .then(rep => {

                    const refinedData = JSON.parse(rep.substr(47).slice(0, -2));

                    refinedData.table.rows.forEach((main) => {

                        const name = main.c[0].v;
                        const y = main.c[1].v;
                        const x = main.c[2].v;
                        const layer = main.c[3].v;
                        const color = main.c[4].v;
                        const symbol = main.c[5].v;
                        const desc = main.c[6].v;

                        switch (color) {

                            case 'red':
                            case 'Red': marker = L.marker([Number(y), Number(x)], BaseIcon({ iconUrl: `img/marker-icon-${color.toLowerCase()}.svg` })).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'orange':
                            case 'Orange': marker = L.marker([Number(y), Number(x)], { icon: orangeM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'yellow':
                            case 'Yellow': marker = L.marker([Number(y), Number(x)], { icon: yellowM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'green':
                            case 'Green': marker = L.marker([Number(y), Number(x)], { icon: greenM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'teal':
                            case 'Teal': marker = L.marker([Number(y), Number(x)], { icon: tealM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'cyan':
                            case 'Cyan': marker = L.marker([Number(y), Number(x)], { icon: cyanM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'blue':
                            case 'Blue': marker = L.marker([Number(y), Number(x)], { icon: blueM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'purple':
                            case 'Purple': marker = L.marker([Number(y), Number(x)], { icon: purpleM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'pink':
                            case 'Pink': marker = L.marker([Number(y), Number(x)], { icon: pinkM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'white':
                            case 'White': marker = L.marker([Number(y), Number(x)], { icon: whiteM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'grey':
                            case 'Grey': marker = L.marker([Number(y), Number(x)], { icon: greyM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            case 'black':
                            case 'Black': marker = L.marker([Number(y), Number(x)], { icon: blackM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                            default: marker = L.marker([Number(y), Number(x)], { icon: greyM }).addTo(map).bindPopup(`<b>${name}</b><br />${desc}`); break;

                        }
                    });
                });
        }

    </script>
</body>
</html>