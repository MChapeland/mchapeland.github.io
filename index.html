<!DOCTYPE html>
<html>

<head>

	<!-- Title of the page -->
	<title>Project World Map</title>

	<!-- Page Setup -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=2.0" />
	<meta http-equiv="X-UA-Compatible" content="ie-edge" />

	<link rel="stylesheet" href="index.css" />
	<link rel="stylesheet" href="src/sidebar.css" />
	<script src="src/sidebar.js" defer></script>

	<!-- Leaflet Scripts -->
	<link rel="stylesheet" href="src/leaflet.css" />
	<script src="src/leaflet.js"></script>

</head>


<body>

	<!-- Map -->
	<div id="map"></div>

	<!-- Sidebar -->
	<div class="sidebar" id="Main">

		<div class="sidebar-grid">
		
			<img src="src/images/logo.svg" />

			<div style="flex: 1;"></div>

			<button class="sidebar-button" id="SearchButton" onclick="toggleDrop(event, 'Search')">
				<img src="src/images/icons/search.svg" />
			</button>

			<button class="sidebar-button" id="LayersButton" onclick="toggleDrop(event, 'Layers')">
				<img src="src/images/icons/layers.svg" />
			</button>

			<button class="sidebar-button" id="OptionsButton" onclick="toggleDrop(event, 'Options')">
				<img src="src/images/icons/options.svg" />
			</button>

		</div>

	</div>

	<!-- SIDEBAR DROPS -->
	<!-- Search -->
	<div class="tabs" id="Search">

		<div class="search-box">

			<input class="searchInput" type="text" placeholder="Search Markers..." />

			<button class="search-button" href="#">
				<img src="src/images/icons/search.svg" />
            </button>

		</div>

		
		<div class="search-result">
			<img src="src/images/markers/blue/ring.svg"/>
			<label>JohnggggIIIIIIIIIIIIIIII</label>
			<p>Lore, lamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/blue/ring.svg" />
			<label>Johngggggggggggggggggggggggggggggggg</label>
			<p>Loralp ex ea commodo consequat. </p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/blue/ring.svg" />
			<label>Path</label>
			<p>Lorqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/blue/ring.svg" />
			<label>Ring</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/blue/ring.svg" />
			<label>Warzone</label>
			<p>Lorem.</p>
		</div>

		<div class="search-result">
			<img src="src/images/markers/blue/ring.svg" />
			<label>City</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/blue/ring.svg" />
			<label>Defense</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/markers/blue/ring.svg" />
			<label>Archery</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/icons/stats.svg" />
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, consna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>

		<div class="search-result">
			<img src="src/images/icons/stats.svg" />
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, coniam, quis nosmco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/icons/stats.svg" />
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, consectetim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/icons/stats.svg" />
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>
		
		<div class="search-result">
			<img src="src/images/icons/stats.svg" />
			<label>John</label>
			<p>Lorem ipsummmodo consequat.</p>
		</div>

		<div class="search-result">
			<img src="src/images/icons/stats.svg" />
			<label>John</label>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
		</div>

	</div>

	<!-- Layers -->
	<div class="tabs" id="Layers">
		
		<!--
		<div class="custom-layer-group">

			<div class="group-container">

				<div class="arrow-container">
					<div class="arrow"></div>
					<input type="checkbox" >
				</div>

				<div class="visibility-box">
					<label>NPCs</label>
					<input type="checkbox" checked>
				</div>

            </div>

			<div class="layer-grid">

				<div class="layer-container">
					<img src="src/images/markers/blue/ring.svg" />

					<div class="visibility-box">
						<label>NPCs</label>
						<input type="checkbox" checked>
					</div>
					
					<p>5</p>
				</div>

			</div>
			

		</div>
		 -->

	</div>

	<!-- Options -->
	<div class="tabs" id="Options">

	</div>

	<script>

		//Map Setup
		var map = L.map('map', { 'attributionControl': false, zoomControl: false }).setView([-15, 15], 2);

		var tiles = L.tileLayer('map/{z}/{x}/{y}.png', {
			continuousWorld: false,
			noWrap: true,
			minZoom: 2,
			maxZoom: 6
		}).addTo(map);

		var BaseIcon = L.Icon.extend({
			options: {
				iconSize: [25, 25],
				iconAnchor: [12.5, 12.5],
				popupAnchor: [-0.5, -42],
				tooltipAnchor: [19.5, -25]
			}
		});
		
		/*
		marker = L
							.marker([0, 0], {	icon: new BaseIcon({ iconUrl: `src/images/markers/marker-red.svg`}) })
							.addTo(map)
							.bindPopup(`<label><b>Name</b></label>`, {closeButton: false})
							.bindTooltip("Name");
		*/

        // Data fetched from Google Sheets
        const sheetID = '1lB1RY3fwmw9k0t_M4vQt6z__ieHWX7frPUhjbey-9S0';
        const base = 'https://docs.google.com/spreadsheets/d/1lB1RY3fwmw9k0t_M4vQt6z__ieHWX7frPUhjbey-9S0/gviz/tq?';

        const sheetName = 'users';

        const query = encodeURIComponent('Select *');

        const url = `${base}&sheet=${sheetName}&tq=${query}`;

        document.addEventListener('DOMContentLoaded', sheetExtract);

        function sheetExtract() {
            fetch(url)
                .then(res => res.text())
                .then(rep => {

                    const refinedData = JSON.parse(rep.substr(47).slice(0, -2));

                    refinedData.table.rows.forEach((main) => {

                        const name = main.c[0].v;
                        const y = main.c[1].v;
                        const x = main.c[2].v;
                        const group = main.c[3].v;
                        const layer = main.c[4].v;
                        const color = main.c[5].v;
                        const icon = main.c[6].v;
                        const desc = main.c[7].v;
                        const id = main.c[8].v;

						if (document.getElementById(`LG_${group}`) == null){
							//Create a new layer group
							let newLayerGroup = document.createElement("div");
							newLayerGroup.classList.add('custom-layer-group');


								//In the layer group create a group container
								let newGroupContainer = document.createElement("div");
								newGroupContainer.classList.add('group-container');
								newLayerGroup.appendChild(newGroupContainer);
								
									//In the group container create an arrow container
									let newArrowContainer = document.createElement("div");
									newArrowContainer.classList.add('arrow-container');
									newGroupContainer.appendChild(newArrowContainer);
									
										//In the arrow container create an arrow
										let newArrow = document.createElement("div");
										newArrow.classList.add('arrow');
										newArrowContainer.appendChild(newArrow);

										//In the arrow container create a checkbox
										let newACCheckbox = document.createElement("input");
										newACCheckbox.type = "checkbox";
										newACCheckbox.checked = false;
										newArrowContainer.appendChild(newACCheckbox);

									//In the group container create a visibility box
									let newVisibilityBox = document.createElement("div");
									newVisibilityBox.classList.add('visibility-box');
									newGroupContainer.appendChild(newVisibilityBox);

										//In the group container create a label
										let newLabel = document.createElement("label");
										newLabel.innerText = `${group}`;
										newVisibilityBox.appendChild(newLabel);

										//In the visibility box create a checkbox
										let newVBCheckbox = document.createElement("input");
										newVBCheckbox.type = "checkbox";
										newVBCheckbox.checked = true;
										newVisibilityBox.appendChild(newVBCheckbox);


								//In the layer group create a group container
								let newGridContainer = document.createElement("div");
								newGridContainer.classList.add('layer-grid');
								newGridContainer.id = `LG_${group}`;
								newLayerGroup.appendChild(newGridContainer);
								

							//Append the whole thing to the Layers tab
							document.getElementById("Layers").appendChild(newLayerGroup);

						}

						if (document.getElementById(`MG_${layer}-LG_${group}`) == null){
							
							//Create a new marker group
							let newMarkerGroup = document.createElement("div");
							newMarkerGroup.classList.add('layer-container');
							newMarkerGroup.id = `MG_${layer}-LG_${group}`;
							
								//In the marker group create a label
								let newIcon = document.createElement("img");
								newIcon.src = `src/images/markers/${color.toLowerCase()}/${icon.toLowerCase()}.svg`;
								newMarkerGroup.appendChild(newIcon);
								
								//In the marker group create a visibility box
								let newBox = document.createElement("div");
								newBox.classList.add('visibility-box');
								newMarkerGroup.appendChild(newBox);
								
									//In the marker group create a label
									let newLabel = document.createElement("label");
									newLabel.innerText = `${layer}`;
									newBox.appendChild(newLabel);

									//In the visibility box create a checkbox
									let newCheckbox = document.createElement("input");
									newCheckbox.type = "checkbox";
									newCheckbox.checked = true;
									newBox.appendChild(newCheckbox);
								
								//In the marker group create a visibility box
								let newNumber = document.createElement("p");
								newNumber.innerText = `${y}`;
								newMarkerGroup.appendChild(newNumber);
						
							//Append the whole thing to the proper layer group
							document.getElementById(`LG_${group}`).appendChild(newMarkerGroup);

						}

                        marker = L
							.marker([Number(y), Number(x)], {	icon: new BaseIcon({ iconUrl: `src/images/markers/${color.toLowerCase()}/${icon.toLowerCase()}.svg`}) })
							.addTo(map)
							.bindPopup(`<label><b>${name}</b></label><br /><p>${desc}</p><br /><p>${id}</p>`, {closeButton: false})
							.bindTooltip(name);
                        
                    });
                });
        }


	</script>


</html>